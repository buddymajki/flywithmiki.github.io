<!DOCTYPE html>
<html>
<head>
    <title>FLYwithMIKI FlightDeck</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background similar to the image */
            color: #e2e8f0;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            border-radius: 1.5rem;
            background-color: #2d3748;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);

        }

        /* DASHBOARD kártyákhoz*/
		.w3-card-2 {
			background-color: #2d3748;
			border-radius: 1.5rem;
			box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
			padding: 2rem;
			height: 100%;
			/* Flexbox a tartalom középre igazításához */
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			text-align: center;
		}
		.my-flex-container {
			display: flex;
			justify-content: center; /* This will horizontally center the cards */
			align-items: stretch; /* This is the default, and it makes all flex items the same height */
			flex-wrap: wrap; /* Allows the items to wrap to a new line if the container is too narrow */
		}

		/* Optional: Add a class to the inner card div to make it a flex container as well.
		This helps if you need to align content vertically inside the card. */
		.my-card {
			display: flex;
			flex-direction: column;
			justify-content: center; /* This centers content vertically inside the card */
			height: 100%; /* Important for making sure the inner card fills its container */
		}		
		/* DASHBOARD kártyákhoz*/
        
		
		
        .check-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            border-bottom: 1px solid #4a5568;
            cursor: pointer;
            gap: 10px;
        }
        .check-item:last-child { border-bottom: none; }
        .check-item:hover { background-color: rgba(0,0,0,0.05); }
        .check-item.completed { 
            background: #2b352b; 
            color: #90ee90; 
            font-weight: bold; 
            text-decoration: line-through; 
            opacity: 0.7; 
        }


   /* Kiszínezi a checklist topicok fejlécét */
       .checklistheader {
            background-color: #9f7aea;
            color: #E5E1E1; 
            font-weight: bold;
            text-align: center;
            font-size: 25px;
        }

        
        
        .switch {
            position: relative;
            display: inline-block;
            width: 42px;
            height: 22px;
            cursor: pointer;
            flex-shrink: 0;
        }
        .switch input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            margin: 0;
            padding: 0;
        }
        .slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .2s;
            border-radius: 22px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .2s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #4CAF50; }
        input:checked + .slider:before { transform: translateX(20px); }
        .check-item span { user-select: none; }
        #message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            text-align: center;
        }
        .tab-button {
            cursor: pointer;
            font-weight: bold;
        }

        /* Vertical bar chart styles */
        /* A százalékok konténere */
        .percentage-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 10px;
        }

        /* Az oszlopok közötti hely elosztása */
        .bar-chart-container {
            display: flex;
            justify-content: space-between; /* A sávok közötti teret egyenletesen osztja el, a széleken nem hagy teret */
            align-items: flex-end;
            gap: 1rem;
            width: 100%;
            height: 300px;
            padding: 0 16px; /* Belső margó a bal és jobb oldalon */
        }
        /* A barok egyforma szélességéért */
        .bar-wrapper {
            flex-grow: 1; /* Hogy kitöltse a rendelkezésre álló helyet */
            flex-shrink: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            height: 100%;
            max-width: 100px; /* Max szélesség, hogy ne legyenek túl nagyok az oszlopok */
        }

        /* Legendák stílusa */
        .bar-chart-legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-top: 20px;
            padding: 10px;
            border-top: 1px solid #ddd;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            color: #a0aec0;
        }

        .legend-color-box {
            width: 12px;
            height: 12px;
            margin-right: 5px;
            border-radius: 3px;
        }
        .bar {
            width: 100%;
            height: 100%;
            min-height: 50px;
            border-radius: 0.5rem;
            background-color: #2f3142;
            position: relative;
            display: flex;
            align-items: flex-end;
            overflow: hidden;
        }
        .bar-fill {
            width: 100%;
            background-color: #805ad5;
            border-radius: 0.5rem 0.5rem 0 0;
            transition: height 0.5s ease-in-out;
        }
        .bar-label {
            margin-top: 0.5rem;
            text-align: center;
            font-size: 0.875rem;
            color: #a0aec0;
            white-space: nowrap;
        }
        .bar-percentage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Középre igazítás */
            font-size: 1.5vw;
            font-weight: bold;
            color: white; /* Fehér szöveg */
            text-shadow: 
                -1px -1px 0 #000,  
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000; /* Fekete "kontúr" */
            z-index: 10; /* Hogy a szöveg a kitöltés felett legyen */
        }


        /* Gauge specific styles */
        .gauge-svg-container {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 0rem;
        }
        .gauge-text {
            font-weight: 700;
            font-size: 3rem;
        }
        .gauge-label {
            font-weight: 500;
            font-size: 1.25rem;
            color: #a0aec0;
        }

        /* NEW: Styles for the improved flight history list */
        .flight-entry {
            display: flex;
            flex-direction: column;
            padding: 16px;
            border-bottom: 1px solid #4a5568;
        }

        .flight-entry p {
            margin: 0;
            padding: 4px 0;
        }

        .flight-entry .flight-route {
            font-weight: bold;
            font-size: 1.1em;
            color: #e2e8f0;
        }

        .flight-entry .flight-details {
            font-size: 0.9em;
            color: #a0aec0;
        }
        
        /* NEW: Styles for the modal popup and loading overlay */
        .modal-overlay, .loading-overlay, #save-flight-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-overlay {
            display: none; /* Hidden by default */
        }
        .loading-overlay, #save-flight-loading-overlay {
            display: none; /* Hidden by default */
            color: #e2e8f0;
            font-size: 1.5rem;
            text-align: center;
        }
        .login-popup {
            background-color: #2d3748;
            padding: 2rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
        }

        /* NEW: Loader CSS for initial load */
        .loader {
            width: 50px;
            aspect-ratio: 1;
            border: 2px solid;
            box-sizing: border-box;
            border-radius: 50%;
            display: grid;
            animation: l11 1.5s infinite linear;
            transform-origin: 50% 80%;
            margin-bottom: 1rem;
        }
        .loader:before,
        .loader:after {
            content: "";
            grid-area: 1/1;
            border: inherit;
            border-radius: 50%;
            animation: inherit;
            animation-duration: 1s;
            transform-origin: inherit;
        }
        .loader:after {
            --s:-1;
        }
        @keyframes l11 {
            100% {transform:rotate(calc(var(--s,1)*1turn))}
        }



        /* NEW: Loader CSS for Save Flight */
        .loader-save-flight {
            width: 60px;
            height: 25px;
            border: 2px solid;
            box-sizing: border-box;
            border-radius: 50%;
            display: grid;
            animation: l2 2s infinite linear;
            margin-bottom: 1rem; /* Added margin for spacing */
        }
        .loader-save-flight:before,
        .loader-save-flight:after {
            content: "";
            grid-area: 1/1;
            border: inherit;
            border-radius: 50%;
            animation: inherit;
            animation-duration: 3s;
        }
        .loader-save-flight:after {
            --s:-1;
        }
        @keyframes l2 {
            100% {transform:rotate(calc(var(--s,1)*1turn))}
        }



		/* NEW: Loader css for Save Checklist frissítéshez */
		/* HTML: <div class="loader-save-checklist"></div> */
		.loader-save-checklist {
		  width: 25px;
		  height: 50px;
		  display: grid;
		  background:
			linear-gradient(currentColor 0 0) top/100% 2px,
			radial-gradient(farthest-side at  top, #0000 calc(100% - 2px),currentColor calc(100% - 1px) ,#0000) top,
			linear-gradient(currentColor 0 0) bottom/100% 2px,
			radial-gradient(farthest-side at  bottom, #0000 calc(100% - 2px),currentColor calc(100% - 1px) ,#0000) bottom;
		  background-size: 100% 1px,100% 50%; 
		  background-repeat: no-repeat;
		  animation: l18 4s infinite linear;
		}
		.loader-save-checklist::before,
		.loader-save-checklist::after {
		  content: "";
		  grid-area: 1/1;
		  background: inherit;
		  border: inherit;
		  animation: inherit;
		}
		.loader-save-checklist::after {
		  animation-duration: 2s;
		}
		@keyframes l18 {
		  100% {transform: rotate(1turn)}
		}

		/* Loader csomagoló: Ez biztosítja a középre igazítást */
		.loader-wrapper {
			display: flex;
			justify-content: center;
			align-items: center;
			margin: 1rem 0;
		}

		/* LOADER-gauge */
		.loader-progressgauge {
		  border: 16px solid #f3f3f3;
		  border-radius: 50%;
		  border-top: 16px solid #805ad5;
		  width: 120px;
		  height: 120px;
		  -webkit-animation: spin 2s linear infinite; /* Safari */
		  animation: spin 2s linear infinite;
		  display: none;
		}

		/* Safari */
		@-webkit-keyframes spin {
		  0% { -webkit-transform: rotate(0deg); }
		  100% { -webkit-transform: rotate(360deg); }
		}

		@keyframes spin {
		  0% { transform: rotate(0deg); }
		  100% { transform: rotate(360deg); }
		}
				
		

		/* Theory gombok ugyan akkorák */		
		.same-width-button {
		  width: 250px; /* You can adjust this value as needed */
		  display: block;
		  margin-left: auto;
		  margin-right: auto;
		}



		/* ELVILEG A DASHBOARD KÁRTYÁKAT JOBBAN RENDEZI
		/* Custom CSS */

		/* Ezzel a szabállyal a mérőóra és a kártyák a helyükre kerülnek kis képernyőn is */
		@media (max-width: 1000px) {
			.my-flex-container > .w3-half {
				width: 100% !important;
			}
		}

		/* Flexbox a kiskártyáknak */
		.small-cards-flex {
			display: flex;
			flex-wrap: wrap;
			justify-content: space-between;
		}

		.dashboard-item {
			flex: 1 1 calc(50% - 16px);
			box-sizing: border-box;
			/* Ezek a sorok adják a teret a kártyák körül */
			margin: 8px; /* A kártyák közötti külső tér */
			padding: 8px; /* A kártyákon belüli belső tér */
		}

		/* Ha páratlan számú elem van, középre rendezzük a Flexbox-szal */
		@media (min-width: 601px) {
			.small-cards-flex:after {
				content: "";
				flex: auto;
			}
		}



/* Checklist info iconhoz css*/
.info-icon {
    margin-left: 8px;
    color: #9f7aea;
    cursor: pointer;
    font-size: 1.1em;
}

/* This is important to ensure the icon doesn't trigger the checkbox toggle */
.check-item > span > .info-icon {
    pointer-events: auto;
}
/* Modal háttér checklist info-hoz*/
.modal {
    display: none; 
    position: fixed;
    z-index: 10;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; 
    background-color: rgba(0,0,0,0.4); 
    padding-top: 60px;
}

/* Modal tartalom */
.modal-content {
    background-color: #2d3748;
    margin: 5% auto; 
    padding: 20px;
    border: 1px solid #888;
    width: 80%; 
    max-width: 500px;
    border-radius: 1.5rem;
    box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
    position: relative;
    color: #e2e8f0;
}

/* Bezáró gomb */
.close-button {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close-button:hover,
.close-button:focus {
    color: #e2e8f0;
    text-decoration: none;
    cursor: pointer;
}




    </style>

<link rel="icon" type="image/x-icon" href="https://flywithmiki.com/Images_v2/favicon.ico">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">


</head>
<body>


    <div class="container">
    <img src="https://flywithmiki.com/Images_v2/logo1.webp" class="" alt="logoc" style="max-width:900px; width: 100%; margin:auto; filter: drop-shadow(7px 7px 7px white); display: block;">
        
        
        <h1 class="w3-center" id="main-title">Flight Deck</h1>
		
		

        <h3 class="w3-center" id="login-tab">LOGIN</h3>




        <div class="w3-bar w3-asphalt" style="max-width:1150px; margin:auto">            
            <button class="w3-bar-item w3-button tab-button" id="dashboard-tab" style="display: none;">Dashboard</button>
            <button class="w3-bar-item w3-button tab-button" id="checklist-tab" style="display: none;">Checklist</button>
            <button class="w3-bar-item w3-button tab-button" id="flight-data-tab" style="display: none;">Flight Book</button>
            <button class="w3-bar-item w3-button tab-button" id="addflight-tab" style="display: none;">Add Flight</button>
			<button class="w3-bar-item w3-button tab-button w3-right" id="theory-tab" style="display: none;">Theory</button>
        </div>

        

<!--DASHBOARD------------------------------------------------------------------------------------->
<div id="dashboard-section" class="tab-content" style="display:none;">
            <div class="dashboard-container">
               


				<!--DASHBOARD KÁRTYÁK------------------------------------------------------------------------------------->
<div class="w3-row-padding w3-margin-top my-flex-container">
    
	<div class="w3-half w3-container w3-margin-bottom">
		<div class="w3-card-2">
			<h3 class="w3-center w3-text-gray">School progress</h3>
			<div class="loader-wrapper">
				<div class="loader-progressgauge" id="loader-progressgauge"></div>
			</div>
			<div class="gauge-svg-container" id="gauge-container"></div>
			<p class="w3-center w3-large" id="gauge-debug-text" style="margin-top: 10px;"></p>
		</div>
	</div>
		
    <div class="w3-half w3-row-padding small-cards-flex">
        <div class="dashboard-item">
            <div class="w3-card-2 w3-center my-card">
                <h3 class="w3-text-gray">Total Flights</h3>
                <div class="w3-xxlarge" id="total-flights-dashboard"><span id="total-flights-count-display">0</span></div>
            </div>
        </div>
        <div class="dashboard-item">
            <div class="w3-card-2 w3-center my-card">
                <h3 class="w3-text-gray">Total Airtime</h3>
                <div class="w3-xlarge" id="total-airtime-dashboard"><span id="total-air-time-summary">0 minutes</span></div>
            </div>
        </div>		
        <div class="dashboard-item">
            <div class="w3-card-2 w3-center my-card">
                <h3 class="w3-text-gray">Takeoff Sites</h3>
                <div class="w3-xxlarge w3-text-gray" id="takeoff-sites-dashboard"> <span id="takeoffs-count-display">0</span></div>
            </div>
        </div>
        <div class="dashboard-item">
            <div class="w3-card-2 w3-center my-card">
                <h3 class="w3-text-gray">Landing Sites</h3>
                <div class="w3-xxlarge" id="landing-sites-dashboard"><span id="landings-count-display">0</span></div>
            </div>
        </div>

        <div class="dashboard-item">
            <div class="w3-card-2 w3-center my-card">
                <h3 class="w3-text-gray">Cumm. Altitude</h3>
                <div class="w3-xlarge w3-text-gray" id="altitude-cumulative-dashboard">0 m</div>
            </div>
        </div>
    </div>

</div>
				<!--DASHBOARD KÁRTYÁK------------------------------------------------------------------------------------->
				
				


				<!--GRAFIKON KÁRTYÁK------------------------------------------------------------------------------------->			   
				<div class="w3-row-padding w3-margin-bottom my-flex-container">

					<div class="w3-threequarter w3-container w3-margin-bottom">
						<div class="w3-card-2 ">
							<h3 class="w3-center ">Control Sheet Progress</h3>
							<div class="bar-chart-container" id="bar-chart-container"></div>
							<div id="bar-chart-legend" class="w3-padding" ></div>
						</div>
					</div>
				</div>
				<!--GRAFIKON KÁRTYÁK------------------------------------------------------------------------------------->

				


				
            </div>
</div>
        
        

<!--Flightbook------------------------------------------------------------------------------------->
<div class="w3-container w3-padding tab-content" style="display:none;" id="flight-data-section">




            <div class="w3-card w3-round-large w3-margin">
                <div class="w3-container">
                    <h3>Flight history:</h3>
                    <ul id="flight-history-list" class="w3-ul w3-border-top">
                    </ul>
                </div>
            </div>
        </div>



<!-- ADDFLIGHT------------------------------------------------------------------------------------>
<div class="w3-container w3-padding tab-content" style="display:none;" id="addflight-section">
            <div id="flight-form-section">
                <div class="w3-card w3-round-large w3-margin">
                    <div class="w3-container">
                        <h3>New Flight</h3>
                        <form id="addflight-form" method="post">
                            <p>
                                <label>Date:</label>
                                <input class="w3-input w3-border w3-round-large" type="date" name="flight-date" id="addflight-date-input" required>
                            </p>
                            <p>
                                <label>Takeoff:</label>
                                <select class="w3-select w3-border w3-round-large" name="takeoff-location" id="addflight-takeoff-location" required>
                                    <option value="" disabled selected>Select a takeoff location</option>
                                    <option value="Büelen (1089m)">Büelen (1089m)</option>
                                    <option value="Brändlen-South (1208m)">Brändlen-South (1208m)</option>
                                    <option value="Brändlen-North (1228m)">Brändlen-North (1228m)</option>
                                    <option value="Diegisbalm (1103m)">Diegisbalm (1103m)</option>
                                    <option value="Engelberg - Brunnihütte (1868m)">Engelberg - Brunnihütte (1868m)</option>
                                    <option value="Engelberg - Tümpfeli (1803m)">Engelberg - Tümpfeli (1803m)</option>
                                    <option value="Emmetten - Niderbauen (1572m)">Emmetten - Niderbauen (1572m)</option>
                                    <option value="Rigi - Staffelhöhe (1546m)">Rigi - Staffelhöhe (1546m)</option>
                                    <option value="Rigi - Seebodenalp (1027m)">Rigi - Seebodenalp (1027m)</option>
									<option value="Rigi - Scheidegg (1641m)">Rigi - Scheidegg (1641m)</option>
									<option value="Rigi - Kulm (1768m)">Rigi - Kulm (1768m)</option>
									<option value="Rigi - Kulm SW (1737m)">Rigi - Kulm SW (1737m)</option>
                                    <option value="Rotenflue - W (1544m)">Rotenflue - W (1544m)</option>
									<option value="Rotenflue - Upper (1543m)">Rotenflue - Upper (1543m)</option>
									<option value="Rotenflue -  Lower (1517m)">Rotenflue -  Lower (1517m)</option>
                                    <option value="Urmiberg (1111m)">Urmiberg (1111m)</option>
									<option value="Zugerberg (938m)">Zugerberg (938m)</option>
                                </select>
                            </p>
                            <p>
                                <label>Landing:</label>
                                <select class="w3-select w3-border w3-round-large" name="landing-location" id="addflight-landing-location" required>
                                    <option value="" disabled selected>Select a landing location</option>
                                    
                                    <option value="Brunnen (434m)">Brunnen (434m)</option>
                                    <option value="Büelen - Neufallenbach (545m)">Büelen - Neufallenbach (545m)</option>
									<option value="Diegisbalm (Nechimatt) (540m)">Diegisbalm (Nechimatt) (540m)</option>
                                    <option value="Emmetten (788m)">Emmetten (788m)</option>
                                    <option value="Engelberg (1008m)">Engelberg (1008m)</option>
									<option value="Goldau (479m)">Goldau (479m)</option>
                                    <option value="Küssnacht (461m)">Küssnacht (461m)</option>
									<option value="Rotenflue - Rickenbach (586m)">Rotenflue - Rickenbach (586m)</option>
                                    <option value="Wolfenschiessen (514m)">Wolfenschiessen (514m)</option>
									<option value="Zug - Bröchli (463m)">Zug - Bröchli (463m)</option>
                                </select>
                            </p>
                            <p>
                                <label>Altitude Difference:</label>
                                <span id="addflight-altitude-difference" class="w3-tag w3-round-large w3-light-grey">0m</span>
                            </p>
                            <p>
                                <label>Flight Time:</label>
                                <select class="w3-select w3-border w3-round-large" name="flight-time" required>
                                    <option value="" disabled selected>Select flight time</option>
                                    <option value="5">5 minutes</option>
                                    <option value="10">10 minutes</option>
                                    <option value="15">15 minutes</option>
                                    <option value="20">20 minutes</option>
                                    <option value="25">25 minutes</option>
                                    <option value="30+">30+ minutes</option>
                                </select>
                            </p>
                            <p>
                                <label>Comments:</label>
                                <textarea class="w3-input w3-border w3-round-large" name="comments" rows="3"></textarea>
                            </p>
                            <p>
                                <button id="addflight-save-button" style="background-color:#805ad5" type="submit" class="w3-button w3-round-large w3-margin-bottom">Save Flight</button>
                            </p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
 
 
 
<!--THEORY-----------------------------------------------------------------------------------> 
<div class="w3-container w3-padding tab-content" style="display:none;" id="theory-section">
    <div class="w3-card w3-round-large w3-margin">
        <div class="w3-container">
            <h3 class="w3-center w3-text-white">Theory Files</h3>
            <p>
                <a href="https://flywithmiki.com/theory/aerodynamics.pdf" target="_blank" class="w3-button w3-round-large w3-margin-bottom  same-width-button" style="background-color:#805ad5">Aerodynamics</a>
            </p>
            <p>
                <a href="https://flywithmiki.com/theory/flightpraxis.pdf" target="_blank" class="w3-button w3-round-large w3-margin-bottom  same-width-button" style="background-color:#805ad5">Flying practice</a>
            </p>
            <p>
                <a href="https://flywithmiki.com/theory/law.pdf" target="_blank" class="w3-button w3-round-large w3-margin-bottom same-width-button" style="background-color:#805ad5">Legislation (Airspaces)</a>
            </p>
            <p>
                <a href="https://flywithmiki.com/theory/material.pdf" target="_blank" class="w3-button w3-round-large w3-margin-bottom same-width-button" style="background-color:#805ad5">Material Sciences</a>
            </p>
            <p>
                <a href="https://flywithmiki.com/theory/meteo.pdf" target="_blank" class="w3-button w3-round-large w3-margin-bottom same-width-button" style="background-color:#805ad5">Weather</a>
            </p>
        </div>
    </div>
</div>
<!--THEORY----------------------------------------------------------------------------------->        
        
<!--CHECKLIST----------------------------------------------------------------------------------->
<div id="checklist-container" class="tab-content" style="display: none;">
 <form id="form">
	 <div style="padding: 16px; text-align: center;">
		<button class="w3-button w3-round" style="background-color:#805ad5" type="submit" id="submit-button">Save Checklist</button>
	 </div>
				
		
				
				<H2 class="w3-center" style="align:center; margin:auto">Basic Training</h2>
					<div class="w3-row-padding w3-margin-top">
						<div class="w3-half">
							<div class="w3-card w3-white w3-margin-bottom">
							<header class="w3-container checklistheader">
								<h4>Basic Ground Handling and Launch Techniques</h4>
							</header>
							<div class="check-item" data-info-html="This task teaches the student how to properly unpack their glider and lay it out for takeoff. The goal is to learn how to prepare the wing on steep launch sites with minimal movement. After laying out the wing, the student should be able to sort the lines and get ready for launch.">
								<span>1. Laying out the glider <i class="info-icon fa fa-info-circle"></i> </span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-0" name="gh-bas-0" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student will get familiar with the paragliding equipment, learn how to clip into the harness, and correctly attach the glider's risers to the carabiners. This is done with the wing already laid out and lines sorted.">
								<span>2. Equipment Familiarisation <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-1" name="gh-bas-1" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns how to **inflate the canopy** and control it while walking, gaining a feel for its movements and a basic understanding of control inputs.<br><br><b>Important Tip:</b> Always stay directly under the glider when it is not overhead. If the glider drifts to one side, **walk diagonally underneath it** while applying a counter-steering brake input on the opposite side. When executed correctly, the glider will return to a stable position directly above your head.">
								<span>3. Inflation and walking exercises <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-2" name="gh-bas-2" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="<b>The 5-Point Safety Check</b><br><br>This critical check must be performed before every flight:<br><br><b>1. Rescue:</b> Ensure the rescue handle is in place and the bridle channel is closed. (This is done before you put on the harness).<br><b>2. Pilot:</b> Check that your shoes, leg straps, chest strap, and helmet are all closed. The carabiners should be attached and your radio turned on.<br><b>3. Lines:</b> On both sides, check that the A lines are on top and the brake line is free between your hand and the pulley/ring.<br><b>4. Glider:</b> Verify that the glider is laid out neatly, the leading edge is open, and it is more or less facing into the wind.<br><b>5. Wind and Surroundings:</b> Confirm the wind direction and strength are suitable for a safe launch. Check the airspace (no one is flying in front of the takeoff, no one is top-landing, and no one is flying above you). Finally, establish an imaginary line where you can still control the glider, as a last-resort decision-making point."
								<span>4. 5-Point Check and Launch Preparations <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-3" name="gh-bas-3" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns to establish a clear decision-making point before takeoff. Latest until this line, they must make a definitive 'Start' or 'Stop' decision to ensure a safe launch.<br><br><b>In the event of a 'Stop' (abort) decision:</b><br>The student must quickly pull down one brake line completely while raising the opposite hand. Simultaneously, they should follow the glider's movement, walking in a curved path until the wing safely falls to the ground. The chosen direction should always be towards the most open space.">
								<span>5. Start-STOP (Decision making line) <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-4" name="gh-bas-4" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns the three distinct phases of a forward launch:<br><br><b>1. Inflation:</b> The glider fills with air and rises to the horizon.<br><br><b>2. Control:</b> With a firm brake input, the student stops the glider precisely above their head to prevent overshooting. They then maintain control, making small direction changes if needed and visually checking for any knots or cravattes before continuing.<br><br><b>3. Acceleration:</b> Once the glider is stable and the airspace is clear, the student performs a smooth takeoff with a final acceleration, adopting a dynamic pose for the run. (Chicken pose)">
								<span>6. 3-Phase Launch (forward) <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-5" name="gh-bas-5" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns how to effectively change direction in flight, mastering basic turns and maneuvers. A key principle is to <b>'look and lean'</b> where you want to fly, shifting your weight while gently pulling the brake on that side.">
								<span>7. Flights with Direction Changes <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-6" name="gh-bas-6" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns the basic techniques for a safe and controlled landing, including the approach and flare. A key part of this is learning to pull both brakes down completely at approximately one meter from the ground, which allows for a gentle touchdown.">
								<span>8. Landing Techniques <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-7" name="gh-bas-7" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns to perform 90- and 180-degree turns.">
								<span>9. 90 - 180° Turns (Landing Approach) <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-8" name="gh-bas-8" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns how to properly fold the glider using different methods, such as the standard glider-bag, the concertina bag, or the fast bag.">
								<span>10. Folding Methods <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-bas-9" name="gh-bas-9" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
						</div>
	
				</div>
				
				
				
				<div class="w3-half">
					<div class="w3-card w3-white w3-margin-bottom">
							<header class="w3-container checklistheader">
								<h4>Advanced Groundhandling</h4>
							</header>
							<div class="check-item" data-info-html="The student practices controlling the canopy while walking in a slalom pattern on flat ground, improving fine control and responsiveness. For optimal results, practice in wind speeds of 5-15 km/h.<br><br>First, start to pull the brake while walking with the glider. As it begins to turn, walk along a curved path to follow its movement until a new direction is achieved. Once stable, your hands should be parallel again.">
								<span>1. Slalom walking <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-adv-0" name="gh-adv-0" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns techniques for safely launching the glider when the wind is not coming directly from the front.<br><br>The wing will inflate towards the wind direction. The student must then bring the wing to the desired takeoff direction. If it's not possible to correct the glider's position, the student must perform a 'Start-Stop' abort maneuver.">
								<span>2. Crosswind Launch (Simulation if necessary) <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-adv-1" name="gh-adv-1" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns how to handle and launch a glider when the canopy is not perfectly laid out, a crucial skill for real-world scenarios.">
								<span>3. Launch with Poorly Laid-Out Canopy <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-adv-2" name="gh-adv-2" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns the backward launch technique, which is essential for strong wind conditions and provides better canopy control before takeoff.">
								<span>4. 3-Phase Launch (backward) <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-adv-3" name="gh-adv-3" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student learns how to quickly and efficiently untangle lines on the ground to prevent launch issues.">
								<span>5. Untangling the lines <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-adv-4" name="gh-adv-4" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
							<div class="check-item" data-info-html="The student masters ground handling while walking downhill without taking off. They are able to make small changes in direction on the slope and keep the glider inflated without becoming airborne. This is best practiced in a slight updraft.">
								<span>6. Hill walking <i class="info-icon fa fa-info-circle"></i></span>
								<label class="switch">
									<input type="checkbox" id="gh-adv-5" name="gh-adv-5" value="TRUE" />
									<span class="slider"></span>
								</label>
							</div>
						</div>
					</div>

				</div>	




				<H2 class="w3-center" style="align:center; margin:auto">Theory</h2>				
				<div class="w3-row-padding w3-margin-top">
						<div class="w3-half">
							<div class="w3-card w3-white w3-margin-bottom">
								<header class="w3-container checklistheader">
									<h4>In-Flight Safety and Emergency Procedures</h4>
								</header>
								<div class="check-item" data-info-html="The student learns about the purpose, location, and proper deployment of the rescue parachute in an emergency.">
									<span>1. Introduction to Rescue System <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-flight-0" name="th-flight-0" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns various techniques for performing a safe landing in emergency situations, such as landing in a small field or on difficult terrain. They will understand the strategies, techniques, and risks involved with landings on water, in trees, or on a hillside.">
									<span>2. Emergency Landing Techniques <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-flight-1" name="th-flight-1" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns how to safely land when the wind is coming from behind. While not recommended, it is a critical skill for an emergency situation.">
									<span>3. Downwind Landing <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-flight-2" name="th-flight-2" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to recognize and safely recover from a parachutal stall, a state where the wing loses forward speed but remains inflated.">
									<span>4. Parachutal Stall <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-flight-3" name="th-flight-3" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to recognize and safely recover from a spiral dive, a high-speed descent that can occur due to a steep turn.">
									<span>5. Spiral dive <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-flight-4" name="th-flight-4" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
					</div>
					</div>
					
					
					<div class="w3-half">
						<div class="w3-card w3-white w3-margin-bottom">
								<header class="w3-container checklistheader">
									<h4>Core Theory</h4>
								</header>
								<div class="check-item" data-info-html="The student learns the fundamental principles of flight, including how air interacts with the paraglider wing to create lift and drag. They will understand the difference between a collapse and a stall, and know the theoretical background of how to avoid these critical flying disturbances.">
									<span>1. Aerodynamics <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-core-0" name="th-core-0" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to read weather forecasts, understand atmospheric conditions, and identify flying hazards like turbulence, strong winds and typical weather situations in Switzerland.">
									<span>2. Weather <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-core-1" name="th-core-1" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns the best practices for safe and efficient flying, including flight planning and flying disturbances.">
									<span>3. Flying practice <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-core-2" name="th-core-2" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns the rules and regulations governing paragliding, including air-law and airspace classifications.">
									<span>4. Legislation (Air-law and airspaces) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-core-3" name="th-core-3" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns about the materials used in paragliders, how they affect performance, and how to maintain them.">
									<span>5. Material Sciences <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="th-core-4" name="th-core-4" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
					</div>
					</div>
					</div>
				
				
				
				
				<H2 class="w3-center" style="align:center; margin:auto">Altitude Flights</h2>				
				<div class="w3-row-padding w3-margin-top">				
					


					<div class="w3-half">
						<div class="w3-card w3-white w3-margin-bottom">
								<header class="w3-container checklistheader">
									<h4>Basic Flight Maneuvers</h4>
								</header>
								<div class="check-item" data-info-html="From the 'hands up' position, the student initiates a turn by shifting their weight in the desired direction. This is followed by a smooth and progressive pull on the 'inside' brake handle. The outside brake handle is then used to control the glider's speed and bank angle.">
									<span>1. Steering (positive) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-bas-0" name="hf-bas-0" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student begins a turn from a 'slowed down' position (both hands are at shoulder-chest level). Using a significant amount of weight shift, the 'outside' brake is partially released, allowing the glider to turn in a flat, controlled manner. This is the preferred method for landing approaches to avoid dynamic turns close to the ground.">
									<span>2. Steering (negative) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-bas-1" name="hf-bas-1" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to steer the glider using only their body weight, without touching the brakes. This maneuver is used to perform 90-180° turns or even full circles in both directions when conditions allow.">
									<span>3. Steering (weight shift) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-bas-2" name="hf-bas-2" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student practices the standard landing approach (left or right, depending on the field), which involves a specific pattern to line up for landing:<br><br><b>1. Descending Area:</b> This is where you lose altitude and position yourself for the beginning of the landing pattern.<br><br><b>2. Downwind Leg:</b> Flying with a tailwind on the side of the landing field, moving towards the landing zone's leeward side.<br><br><b>3. Base Leg:</b> Flying crosswind. In stronger winds, you must compensate for drift by steering the glider appropriately relative to the wind direction.<br><br><b>4. Final Leg:</b> Flying straight to the desired landing area with your hands parallel. Small changes in direction can be made with weight shift, but no dramatic turns. At approximately one meter from the ground, you fully flare the glider by pulling both brakes down completely.">
									<span>4. Landing (school approach) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-bas-3" name="hf-bas-3" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to perform a controlled descent by partially collapsing the wingtips ('Big Ears') without using the speedbar. To do this, keep your brakes on your wrists, then with your palms facing down, grab the outermost A lines on both sides and pull them down one by one. To exit the maneuver, simply release the A lines. If the ears do not pop back out, a single, short pump with the brake on the closed side will reinflate it.">
									<span>5. Big Ears (without speedbar) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-bas-4" name="hf-bas-4" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns how to use the speedbar to increase the glider's forward speed.">
									<span>6. Use of Acceleration System <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-bas-5" name="hf-bas-5" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to perform a controlled high-speed descent using both 'Big Ears' and the speedbar. The correct order is:<br><br><b>1.</b> Step on the speedbar.<br><b>2.</b> Close the ears one by one.<br><b>3.</b> Maintain full speed.<br><br>To exit the maneuver, reverse the process:<br><br><b>1.</b> Release the speedbar.<br><b>2.</b> Open the ears (with a quick brake pump if needed).<br><b>3.</b> Return to trim speed.">
									<span>7. Big Ears (with speedbar) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-bas-6" name="hf-bas-6" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
					</div>
					</div>
						<div class="w3-half">
							<div class="w3-card w3-white w3-margin-bottom">
								<header class="w3-container checklistheader">
									<h4>Advanced Flight Maneuvers</h4>
								</header>
								<div class="check-item" data-info-html="The student learns to steer the glider using the rear risers. With your brakes on your wrists, grab the rear risers with your palms up and pull them slightly backward and down. <b>Danger:</b> Pulling too much can stall the glider. This maneuver should be practiced at a high altitude to get familiar with the precise amount of input required without causing an issue.">
									<span>1. Steering (back riser) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-0" name="hf-adv-0" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to perform a landing using the back risers. With your brakes on your wrists, you perform the entire landing approach using only weight shift and the rear risers. Approximately 50-60 cm from the ground, you begin the final flare with the rear risers.<br><br><b>Danger:</b> Pulling too hard at a higher altitude can cause a stall, so this maneuver requires precise control.">
									<span>2. Landing (back riser) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-1" name="hf-adv-1" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to combine rolling maneuvers with 'Big Ears' to perform dynamic descents.<br><br><b>1.</b> Make the 'Big Ears' (without the speedbar).<br><b>2.</b> Start a turn by shifting your weight to one side.<br><b>3.</b> Once the glider begins to turn, progressively switch your weight to the other side. This will cause the glider to start 'rolling'.<br><b>4.</b> At the 'highest point' of the roll, switch your weight shift again.<br><br><b>Goal:</b> The student should become familiar with the rolling maneuver and learn the precise moment to switch their weight to achieve a smooth, dynamic roll. This technique can be used to lose altitude relatively quickly in turbulent air.">
									<span>3. Rolling (Big Ears) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-2" name="hf-adv-2" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item"  	data-info-html="The student learns how to perform a rolling maneuver to lose altitude.<br><br><b>Initiating the Roll:</b> The student initiates a turn using a combination of weight shift and inside braking. After the glider has turned approximately 45°, the student leans to the other side over the risers. The glider will begin to turn the other way, at which point the previously pulled brake can be released. As the glider reaches its lowest point, the student begins to pull the new 'inside' brake.<br><br><b>Correct Pattern:</b> Change your weight shift at the highest point of the turn and pull the brake at the lowest point.<br><br><b>Danger:</b> If the timing is not precise, the maneuver can become very dynamic, leading to a collapse on the outside part of the wing. Always use some slight braking on the outside brake to provide support. Pulling too much on the inside brake can cause a stall or a spin. In a school environment, we never practice this maneuver to the 'wingover' state; that is reserved for safety training over water.">
									<span>4. Rolling <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-3" name="hf-adv-3" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns a specific pitching technique (Swiss style) used to control the glider's forward and backward movements. The process is a repeated cycle of <b>slowing down</b> and <b>releasing</b>:<br><br><b>1. Slowing Down:</b> Slowly pull both brakes to carabiner level and hold for a few seconds until both the glider and pilot have slowed down.<br><b>2. Hands Up:</b> Quickly raise your hands. The glider will pitch forward.<br><b>3. Wait:</b> Wait for the glider to swing back above your head.<br><b>4. Pull:</b> Pull the brakes in parallel to support the return swing.<br><b>5. Hands Up:</b> Release the brakes and allow the glider to pitch forward again.<br><br><b>Exiting the Maneuver:</b> As the glider pitches forward and reaches its zenith, make a fast, determined brake input to stop the pitching. Then, slowly release the brakes to allow the glider and pilot to regain forward speed together.<br><br><b>Dangers:</b> Pulling the brakes too much (and holding them below the carabiners while the glider is behind you) could lead to a full stall. When the glider is pitching forward dynamically, a front collapse could occur. To avoid this, gently pull the brakes to 'support' the wing as it shoots forward without exiting the maneuver.">
									<span>5. Pitching (Swiss style) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-4" name="hf-adv-4" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student simulates a side collapse by pulling down all three A lines on one side and then releasing them immediately. The purpose is to observe the feeling of the collapse, the way the glider reopens, the forces on their body, and the amount of turn that occurs.">
									<span>6. Side collapse (lvl1) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-5" name="hf-adv-5" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item"  	data-info-html="The student simulates a side collapse in the same way as in Level 1 but learns to stop the resulting rotation with a determined pull on the outside brake. After the rotation has been successfully stopped, the brake should be released.">
									<span>7. Side collapse (lvl2) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-6" name="hf-adv-6" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to handle and recover from a large side collapse. The process is:<br><br><b>1. Collapse:</b> Induce the side collapse and hold the A lines down.<br><b>2. Stop Rotation:</b> Stop the resulting rotation with a determined pull on the outside brake.<br><b>3. Find the Sweet Spot:</b> Slowly release the outside brake until the glider begins to fly straight again. This teaches the student how to maintain a stable flight path with a collapsed wing.">
									<span>8. Side collapse (lvl3) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-7" name="hf-adv-7" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student performs the Level 3 collapse and then, by combining weight shift with a gentle pull on the outside brake, executes a 90-360° turn to the open side (depending on conditions). After the maneuver, they stabilize their flight direction by returning to the 'sweet spot.' If this is successful, the student can then attempt a turn to the collapsed side by slowly releasing the outside brake and leaning into the collapsed side with weight shift. <b>Important:</b> If the glider begins to turn too dynamically, slow down the turn or stop the rotation completely with the outside brake.">
									<span>9. Side collapse (lvl4) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-8" name="hf-adv-8" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to handle and recover from a front collapse, where the entire leading edge of the wing folds in. The steps are:<br><br><b>1.</b> Keep your brakes on your wrists.<br><b>2.</b> With your palms down, grab all of the A lines.<br><b>3.</b> Pull down all of the A lines and release them immediately.<br><br><b>Danger:</b> After a front collapse, the glider may enter a 'horse-shoe' configuration and fail to reopen. A single, fast pump on the brakes can help to exit this configuration.">
									<span>10. Front collapse <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-9" name="hf-adv-9" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to maintain a safe flying speed to avoid stalls. This is achieved in a two-step process:<br><br><b>1. Slowing Down:</b> The student slows the glider down by pulling both brakes to the carabiner level.<br><br><b>2. Further Slowing:</b> Following the instructor's commands, the student slows the glider even more by pulling the brakes a few more centimeters. To exit the maneuver, slowly raise your hands. <b>Danger:</b> Pulling too much could cause the glider to stall.">
									<span>11. Flying in the Safe Speed Range <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-10" name="hf-adv-10" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to perform tight, controlled circles, a maneuver used for thermalling and staying in updrafts. The process is:<br><br><b>1.</b> Initiate a turn with a combination of weight shift and brake input.<br><b>2.</b> Build speed and energy as the glider's bank angle increases.<br><b>3.</b> Control the speed throughout the maneuver using the outside brake.<br><b>4.</b> Learn how to exit the maneuver smoothly, getting rid of the stored energy.<br><br><b>Danger:</b> If not performed correctly, the glider could enter a 'nose-down spiral,' which can put high G-forces on the pilot.">
									<span>12. Tight circles <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-11" name="hf-adv-11" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to make rapid, controlled turns and direction changes, without spinning the glider.">
									<span>13. Quick Direction Changes <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-12" name="hf-adv-12" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns to perform a figure-eight pattern, combining left and right circles.">
									<span>14. Circle Left, Circle Right (Figure Eight) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-13" name="hf-adv-13" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student learns how to use flying instruments like a variometer to optimize their flight and locate thermals.">
									<span>15. Flying with instruments <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-14" name="hf-adv-14" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student practices soaring in updrafts and thermals to stay aloft for extended periods. This maneuver is demonstrated by flying for more than 30 minutes.">
									<span>16. Soaring / Thermalling (30+ minutes) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-15" name="hf-adv-15" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student practices an emergency landing, landing on the protector (preferably a foam one). The steps are:<br><br><b>1. Legs up</b> At about one meter from the ground, get your legs up.<br><b>2. Brake</b> Pull the brakes completely to get rid off the energy of the glider while touch down"">
									<span>17. Landing (popo) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="hf-adv-16" name="hf-adv-16" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
					</div>
					</div>
					</div>
				
				
				
				
				<H2 class="w3-center" style="align:center; margin:auto">Exam Preparation</h2>				
				<div class="w3-row-padding w3-margin-top">				
					
						<div class="w3-half">
							<div class="w3-card w3-white w3-margin-bottom">
								<header class="w3-container checklistheader">
									<h4>Examination Tasks </span></h4>
								</header>
								<div class="check-item" data-info-html="The student demonstrates a successful three phase forward launch, a key skill for the exam.">
									<span>1. Forward start <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="ex-0" name="ex-0" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student demonstrates a successful three phase backward launch, which is crucial for stronger wind conditions.">
									<span>2. Backward start <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="ex-1" name="ex-1" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student performs two full right circles (720°) in less than 20 seconds, demonstrating control and efficiency. PP1 stands for Prüfungs Program 1.">
									<span>3. Two right circles (720°, less than 20s), PP1 <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="ex-2" name="ex-2" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student performs a figure-eight maneuver with one left and one right turn in under 25 seconds. PP2 stands for Prüfungs Program 2.">
									<span>4. Eight (360° left, 360° right, less than 25s),PP2 <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="ex-3" name="ex-3" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student demonstrates the ability to handle a side collapse, stopping the rotation, stabilizing the flying direction and recover from it safely.">
									<span>5. Side Collapse (level3) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="ex-4" name="ex-4" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student demonstrates the 'Big Ears' maneuver with directional control, performing a 90° left and a 90° right turn.">
									<span>6. Big Ears (90° left, 90° right) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="ex-5" name="ex-5" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student demonstrates the 'Big Ears' maneuver while using the speedbar, a more advanced descent technique.">
									<span>7. Big Ears (with full speed) <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="ex-6" name="ex-6" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student demonstrates a controlled rolling maneuver.">
									<span>8. Rolling <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="ex-7" name="ex-7" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
								<div class="check-item" data-info-html="The student demonstrates a controlled pitching maneuver with a perfect exit.">
									<span>9. Pitching <i class="info-icon fa fa-info-circle"></i></span>
									<label class="switch">
										<input type="checkbox" id="ex-8" name="ex-8" value="TRUE" />
										<span class="slider"></span>
									</label>
								</div>
					</div>
					</div>
					
					</div>
				
				
				
			<div style="padding: 16px; text-align: center;">
				<button class="w3-button w3-round" style="background-color:#805ad5" type="submit" id="submit-button">Save Checklist</button>
			</div>
</form>
</div>
        
</div>
    
    <!-- NEW: Modal and Loading Overlays -->
<div id="modal-overlay" class="modal-overlay">
    <div class="login-popup">
        <div id="login-section" class="tab-content" style="display: flex; flex-direction: column; align-items: center;">
            <img src="https://flywithmiki.com/Images_v2/logo1.webp" class="w3-margin-bottom" alt="logoc" style="max-width:400px; margin:auto; width: 100%; filter: drop-shadow(7px 7px 7px white); display: block;">
            
            <input class="w3-input w3-border w3-round" style="margin:auto; margin-top: 30px;" type="email" id="email-input" placeholder="Your email address">
            <button class="w3-button w3-round w3-margin-top" id="load-button" style="margin:auto; background-color:#805ad5">Load My Progress</button>
        </div>
    </div>
</div>

    <div id="loading-overlay" class="loading-overlay">
        <div class="loader"></div>
        <span>Doing the five point check, please wait...</span>
    </div>

    <!-- NEW: Loading Overlay for Save Flight -->
    <div id="save-flight-loading-overlay" class="loading-overlay">
        <div class="loader-save-flight"></div>
        <span>Sending your flight to the cloudbase ;)</span>
    </div>

    <!-- NEW: Loading Overlay for Save Flight -->
    <div id="save-checklist-loading-overlay" class="loading-overlay">
        <div class="loader-save-checklist"></div>
        <span>Alientechnology is calculating your progress...</span>
    </div>

<script>
    // Változás 1: Globális változó a nem mentett állapot figyelésére
    let isDirty = false;

    // Változás 2: showTab függvény módosítása a nem mentett állapot ellenőrzéséhez
    function showTab(tabId) {
        // Ellenőrizzük, hogy vannak-e nem mentett változások, de ne figyelmeztessünk, ha a felhasználó a menthető fülek (checklist, add flight) között vált.
        const savableTabs = ['checklist-container', 'addflight-section'];
        const isSwitchingBetweenSavableTabs = savableTabs.includes(tabId) && savableTabs.includes(document.querySelector('.tab-content[style*="display: block"]').id);
        
        if (isDirty) {
            const userDecision = confirm("Hold on! You haven't packed your gear! Are you sure you want to take off without hitting the save button?");
            if (!userDecision) {
                return; // Megszakítja a navigációt
            }
        }
        // Ha a felhasználó továbbhalad, a nem mentett állapotot alaphelyzetbe állítjuk.
        isDirty = false;

        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
        });

        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('w3-blue');
        });

        document.getElementById(tabId).style.display = 'block';
        
        const buttonId = tabId === 'login-section' ? 'login-tab' :
                         tabId === 'checklist-container' ? 'checklist-tab' :
                         tabId === 'dashboard-section' ? 'dashboard-tab' :
                         tabId === 'addflight-section' ? 'addflight-tab' :
						 tabId === 'theory-section' ? 'theory-tab' : 'flight-data-tab';
        document.getElementById(buttonId).classList.add('w3-blue');
    }

    // Változás 3: Figyelmeztetés a böngésző "vissza" vagy "bezárás" gombjára
    window.addEventListener('beforeunload', function (e) {
        if (isDirty) {
            e.preventDefault();
            e.returnValue = '';
        }
    });

    // A meglévő elemek és funkciók
    const mainTitle = document.getElementById('main-title');
    const form = document.getElementById("form");
    const submitButton = document.getElementById("submit-button");
    const emailInput = document.getElementById("email-input");
    const loadButton = document.getElementById("load-button");
    const modalOverlay = document.getElementById('modal-overlay');
    const loadingOverlay = document.getElementById('loading-overlay');
    const saveFlightLoadingOverlay = document.getElementById('save-flight-loading-overlay');
    const saveChecklistLoadingOverlay = document.getElementById('save-checklist-loading-overlay');
    const addflightForm = document.getElementById("addflight-form");
    const addflightTakeoffSelect = document.getElementById("addflight-takeoff-location");
    const addflightLandingSelect = document.getElementById("addflight-landing-location");
    const addflightAltitudeDifferenceSpan = document.getElementById("addflight-altitude-difference");
    const addflightDateInput = document.getElementById("addflight-date-input");
    const addflightSaveButton = document.getElementById("addflight-save-button");
    const checklistTabButton = document.getElementById("checklist-tab");
    const dashboardTabButton = document.getElementById("dashboard-tab");
    const flightDataTabButton = document.getElementById("flight-data-tab");
    const addflightTabButton = document.getElementById("addflight-tab");
    const loginTabButton = document.getElementById("login-tab");
	const theoryTabButton = document.getElementById("theory-tab");
    const scriptURL = "https://script.google.com/macros/s/AKfycbwo2_GUywCuJhWrT4WlFJAEOZqL2klbgBRWCitO_RZ1Wz_-vAteDC4z9g3dbiBCWkLp/exec";
    const barChartContainer = document.getElementById('bar-chart-container');
    const gaugeContainer = document.getElementById('gauge-container');
    const totalAirTimeSummary = document.getElementById("total-air-time-summary");
    const flightHistoryList = document.getElementById("flight-history-list");
    const gaugeProperties = {
        radius: 150,
        strokeWidth: 25,
        backgroundArcColor: '#2f3142',
        foregroundArcColor: '#805ad5',
        textColor: '#595959',
    };

    function createVerticalBars(data) {
        const barChartContainer = document.getElementById('bar-chart-container');
        barChartContainer.innerHTML = '';
        data.forEach(item => {
            const barWrapper = document.createElement('div');
            barWrapper.classList.add('bar-wrapper');
            const bar = document.createElement('div');
            bar.classList.add('bar');
            bar.style.height = '100%';
            const barFill = document.createElement('div');
            barFill.classList.add('bar-fill');
            barFill.style.height = `${item.value}%`;
            barFill.style.backgroundColor = item.color;
            const percentageText = document.createElement('span');
            percentageText.classList.add('bar-percentage');
            percentageText.textContent = `${item.value.toFixed(0)}%`;
            bar.appendChild(barFill);
            bar.appendChild(percentageText);
            barWrapper.appendChild(bar);
            barChartContainer.appendChild(barWrapper);
        });
    }


//kiszedi a haladás lineáris értékét a database-ből
async function fetchGaugeData(email) {
    const backendUrl = "https://script.google.com/macros/s/AKfycbwo2_GUywCuJhWrT4WlFJAEOZqL2klbgBRWCitO_RZ1Wz_-vAteDC4z9g3dbiBCWkLp/exec";
    const sheetName = "progr-sheet";
    const url = `${backendUrl}?sheet=${sheetName}&email=${encodeURIComponent(email)}`;

    // Változó a loader elemhez, most már az új ID-vel
    const gaugeLoader = document.getElementById('loader-progressgauge');
    const debugTextElement = document.getElementById('gauge-debug-text');

    // Betöltés kezdete: megjelenítjük a loadert és töröljük a hibaüzenetet
    if (gaugeLoader) {
        gaugeLoader.style.display = "block";
    }
    if (debugTextElement) {
        debugTextElement.textContent = "";
    }

    try {
        const response = await fetch(url);
        const data = await response.json();

        if (data.status === "success" && data.progress && data.progress.linear) {
            const linearValue = parseFloat(data.progress.linear);
            if (!isNaN(linearValue)) {
                // Sikeres betöltés: elrejtjük a loadert és létrehozzuk a grafikont
                if (gaugeLoader) {
                    gaugeLoader.style.display = "none";
                }
                createGauge(linearValue);
            } else {
                console.error("The 'linear' value is not a valid number:", data.progress.linear);
                if (gaugeLoader) {
                    gaugeLoader.style.display = "none";
                }
                if (debugTextElement) {
                    debugTextElement.textContent = "Error: The value is not a number.";
                }
            }
        } else {
            console.error("Failed to fetch gauge data:", data.message);
            if (gaugeLoader) {
                gaugeLoader.style.display = "none";
            }
            if (debugTextElement) {
                debugTextElement.textContent = "Error: Failed to retrieve data.";
            }
        }
    } catch (error) {
        console.error("Error fetching gauge data:", error);
        if (gaugeLoader) {
            gaugeLoader.style.display = "none";
        }
        if (debugTextElement) {
            debugTextElement.textContent = "Error: Network issue.";
        }
    }
}

// You will call this function after the user logs in and the email is available.
// For example:
// const userEmail = 'user@example.com'; 
// fetchGaugeData(userEmail); 

// Existing createGauge function


function createGauge(percentage) {
    const gaugeContainer = document.getElementById('gauge-container'); // Assuming an element with this ID exists
    if (!gaugeContainer) {
        console.error("Gauge container element not found.");
        return;
    }
    gaugeContainer.innerHTML = '';

    const { radius, strokeWidth, backgroundArcColor, foregroundArcColor, textColor } = gaugeProperties;
    const center = radius + strokeWidth / 2;
    const circumference = Math.PI * radius;
    const svgWidth = 2 * center;
    const svgHeight = center + strokeWidth;
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('viewBox', `0 0 ${svgWidth} ${svgHeight}`);
    svg.setAttribute('class', 'w-full');
    const backgroundArc = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    backgroundArc.setAttribute('d', `M${center - radius},${center} A${radius},${radius} 0 0 1 ${center + radius},${center}`);
    backgroundArc.setAttribute('fill', 'none');
    backgroundArc.setAttribute('stroke', backgroundArcColor);
    backgroundArc.setAttribute('stroke-width', strokeWidth);
    backgroundArc.setAttribute('stroke-linecap', 'round');
    const foregroundArc = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    foregroundArc.setAttribute('d', `M${center - radius},${center} A${radius},${radius} 0 0 1 ${center + radius},${center}`);
    foregroundArc.setAttribute('fill', 'none');
    foregroundArc.setAttribute('stroke', foregroundArcColor);
    foregroundArc.setAttribute('stroke-width', strokeWidth);
    foregroundArc.setAttribute('stroke-linecap', 'round');
    foregroundArc.setAttribute('stroke-dasharray', `${circumference},${circumference}`);
    foregroundArc.setAttribute('stroke-dashoffset', circumference * (1 - (percentage / 100)));
    const percentText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    percentText.setAttribute('x', center);
    percentText.setAttribute('y', center - 50);
    percentText.setAttribute('text-anchor', 'middle');
    percentText.setAttribute('dominant-baseline', 'middle');
    percentText.setAttribute('class', 'gauge-text');
    percentText.setAttribute('fill', textColor);
    percentText.textContent = `${percentage}%`;
    svg.appendChild(backgroundArc);
    svg.appendChild(foregroundArc);
    svg.appendChild(percentText);
    gaugeContainer.appendChild(svg);
}

// Call the new function to fetch and display the gauge when needed, 
// for example, when the page loads or a user logs in.
// fetchGaugeData("example.user@email.com"); // Replace with the user's actual email




    
    function updateCompletion(cardElement) {
        const checkboxes = cardElement.querySelectorAll('input[type="checkbox"]');
        const checkedCheckboxes = Array.from(checkboxes).filter(checkbox => checkbox.checked);
        const totalCheckboxes = checkboxes.length;
        let completionPercentage = 0;
        if (totalCheckboxes > 0) {
            completionPercentage = (checkedCheckboxes.length / totalCheckboxes) * 100;
        }
        const completionDisplay = cardElement.querySelector('.completion-display');
        if (completionDisplay) {
            completionDisplay.textContent = `${completionPercentage.toFixed(0)}%`;
        }
        return completionPercentage;
    }

    function updateAllCompletions() {
        const allCards = document.querySelectorAll('.w3-card');
        const chartData = [];
        const legendContainer = document.getElementById('bar-chart-legend');
        legendContainer.innerHTML = '';
        allCards.forEach(card => {
            const cardTitle = card.querySelector('header h4');
            if (cardTitle) {
                const topic = cardTitle.textContent.replace(/\s+\d+%$/, '').trim();
                const completionPercentage = updateCompletion(card);
                const color = getRandomColor();
                chartData.push({
                    topic: topic,
                    value: completionPercentage,
                    color: color
                });
                const legendItem = document.createElement('div');
                legendItem.classList.add('legend-item');
                legendItem.innerHTML = `<span style="background-color: ${color};" class="legend-color-box"></span> ${topic}`;
                legendContainer.appendChild(legendItem);
            }
        });
        createVerticalBars(chartData);
    }

    function getRandomColor() {
        const colors = ['#805ad5', '#4fd1c5', '#d53f8c', '#f6ad55', '#4299e1', '#e53e3e'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    function setChecklistValues(progress, clientName) {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            const value = progress[checkbox.name];
            const isChecked = (String(value).toLowerCase() === "true");
            checkbox.checked = isChecked;
            const parentDiv = checkbox.closest('.check-item');
            if (parentDiv) {
                parentDiv.classList.toggle('completed', isChecked);
            }
        });
        mainTitle.innerHTML = clientName ? `Student Flight Deck <br> Welcome ${clientName}` : 'Student Flight Deck <br> Welcome Anonymus';
        updateAllCompletions();
    }

    function calculateAltitudeDifference(takeoffSelectElement, landingSelectElement, altitudeDifferenceElement) {
        const takeoffValue = takeoffSelectElement.value;
        const landingValue = landingSelectElement.value;
        let takeoffAltitude = 0;
        let landingAltitude = 0;
        if (takeoffValue) {
            const match = takeoffValue.match(/\((\d+)m\)/);
            if (match) {
                takeoffAltitude = parseInt(match[1]);
            }
        }
        if (landingValue) {
            const match = landingValue.match(/\((\d+)m\)/);
            if (match) {
                landingAltitude = parseInt(match[1]);
            }
        }
        const difference = takeoffAltitude - landingAltitude;
        altitudeDifferenceElement.textContent = `${difference}m`;
    }

    function formatMinutesToHoursAndMinutes(totalMinutes) {
        if (totalMinutes < 0) {
            return "Invalid time";
        }
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;
        let timeString = "";
        if (hours > 0) {
            timeString += `${hours}h `;
        }
        timeString += `${minutes}min`;
        return timeString.trim();
    }

    function updateFlightSummary(flights) {
        flightHistoryList.innerHTML = '';
        let totalTime = 0;
        let totalAltitudeDifference = 0;
        let takeoffLocations = new Set();
        let landingLocations = new Set();
        const totalFlights = flights.length;
        const reversedFlights = flights.slice().reverse();

        if (reversedFlights && reversedFlights.length > 0) {
            reversedFlights.forEach((flight, index) => {
                const [email, date, takeoff, landing, time, altitudeDifference, comments] = flight;
                const flightNumber = totalFlights - index;
                let formattedDate = date;
                if (date) {
                    try {
                        const dateObj = new Date(date);
                        if (!isNaN(dateObj.getTime())) {
                            const day = String(dateObj.getDate()).padStart(2, '0');
                            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                            const year = dateObj.getFullYear();
                            formattedDate = `${day}.${month}.${year}`;
                        } else {
                            const parts = date.split('-');
                            if (parts.length === 3) {
                                formattedDate = `${parts[2]}.${parts[1]}.${parts[0]}`;
                            } else {
                                const userFormatMatch = date.match(/(\d{2})T.*\.(\d{2})\.(\d{4})/);
                                if (userFormatMatch) {
                                    formattedDate = `${userFormatMatch[1]}.${userFormatMatch[2]}.${userFormatMatch[3]}`;
                                }
                            }
                        }
                    } catch (e) {
                        console.error("Date parsing error:", e);
                    }
                }
                const flightTime = parseInt(time) || 0;
                totalTime += flightTime;
                const altitudeDiffValue = parseInt(altitudeDifference.replace('m', '')) || 0;
                totalAltitudeDifference += altitudeDiffValue;
                takeoffLocations.add(takeoff);
                landingLocations.add(landing);
                const listItem = document.createElement('li');
                listItem.className = 'w3-padding-small w3-border-bottom flight-entry';
                listItem.innerHTML = `
                    <p class="flight-route">${flightNumber}. ${takeoff} &rarr; ${landing}</p>
                    <p class="flight-details"><strong>Date:</strong> ${formattedDate} | <strong>Time:</strong> ${time} minutes | <strong>Altitude:</strong> ${altitudeDifference}</p>
                    <p class="flight-details"><strong>Comments:</strong> ${comments}</p>
                `;
                flightHistoryList.appendChild(listItem);
            });
        }
        totalAirTimeSummary.textContent = formatMinutesToHoursAndMinutes(totalTime);
        document.getElementById("altitude-cumulative-dashboard").textContent = `${totalAltitudeDifference}m`;
        const totalFlightsCount = flights.length;
        const totalFlightsCountDisplay = document.getElementById("total-flights-count-display");
        document.getElementById("total-flights-count-display").textContent = totalFlightsCount;
        if (totalFlightsCount >= 50) {
            totalFlightsCountDisplay.classList.add("w3-text-green");
            totalFlightsCountDisplay.classList.remove("w3-text-red");
        } else {
            totalFlightsCountDisplay.classList.add("w3-text-red");
            totalFlightsCountDisplay.classList.remove("w3-text-green");
        }
        const takeoffsCount = takeoffLocations.size;
        const totalTakeoffsCountDisplay = document.getElementById("takeoffs-count-display");
        document.getElementById("takeoffs-count-display").textContent = takeoffsCount;
        if (takeoffsCount >= 5) {
            totalTakeoffsCountDisplay.classList.add("w3-text-green");
            totalTakeoffsCountDisplay.classList.remove("w3-text-red");
        } else {
            totalTakeoffsCountDisplay.classList.add("w3-text-red");
            totalTakeoffsCountDisplay.classList.remove("w3-text-green");
        }
        const landingsCount = landingLocations.size;
        const totalLandingsCountDisplay = document.getElementById("landings-count-display");
        document.getElementById("landings-count-display").textContent = landingsCount;
        if (landingsCount >= 5) {
            totalLandingsCountDisplay.classList.add("w3-text-green");
            totalLandingsCountDisplay.classList.remove("w3-text-red");
        } else {
            totalLandingsCountDisplay.classList.add("w3-text-red");
            totalLandingsCountDisplay.classList.remove("w3-text-green");
        }
    }

    loadButton.addEventListener("click", async () => {
        const userEmail = emailInput.value.trim();
        if (!userEmail) {
            alert("Please enter a valid email address.");
            return;
        }
        modalOverlay.style.display = "none";
        loadingOverlay.style.display = "flex";
        loginTabButton.style.display = 'none';
        dashboardTabButton.style.display = 'none';
        flightDataTabButton.style.display = 'none';
        addflightTabButton.style.display = 'none';
        checklistTabButton.style.display = 'none';
        try {
            const checklistResponse = await fetch(`${scriptURL}?email=${encodeURIComponent(userEmail)}&sheet=Sheet1`);
            const checklistData = await checklistResponse.json();
            const flightResponse = await fetch(`${scriptURL}?email=${encodeURIComponent(userEmail)}&sheet=Sheet2`);
            const flightData = await flightResponse.json();
            if (checklistData && checklistData.status === "success" && flightData && flightData.status === "success") {
                setChecklistValues(checklistData.progress, checklistData.clientName);
                if (flightData.flights) {
                    updateFlightSummary(flightData.flights);
                } else {
                    updateFlightSummary([]);
                }
                dashboardTabButton.style.display = 'block';
                flightDataTabButton.style.display = 'block';
                checklistTabButton.style.display = 'block';
                addflightTabButton.style.display = 'block';
				theoryTabButton.style.display = 'block';
                showTab('dashboard-section');
			    fetchGaugeData(userEmail); 
            } else {
                throw new Error("Data loading failed. Please check your email address and sheets.");
            }
        } catch (error) {
            console.error("Error loading data:", error);
            alert("Error loading data. Please try again.");
            modalOverlay.style.display = "flex";
        } finally {
            loadingOverlay.style.display = "none";
        }
    });

		addflightForm.addEventListener("submit", async function (e) {
			e.preventDefault();
			addflightSaveButton.disabled = true;
			saveFlightLoadingOverlay.style.display = "flex";
			const formData = new FormData(this);
			const flightDate = formData.get("flight-date");
			const utcDate = flightDate ? flightDate + 'T12:00:00.000Z' : '';
			const flightDataObj = {
				email: emailInput.value.trim(),
				flightDate: utcDate,
				takeoffLocation: formData.get("takeoff-location"),
				landingLocation: formData.get("landing-location"),
				flightTime: formData.get("flight-time"),
				comments: formData.get("comments"),
				altitudeDifference: addflightAltitudeDifferenceSpan.textContent
			};
			try {
				const response = await fetch(`${scriptURL}?sheet=Sheet2`, {
					redirect: "follow",
					method: "POST",
					body: JSON.stringify(flightDataObj),
					headers: {
						"Content-Type": "text/plain;charset=utf-8",
					},
				});
				const data = await response.json();
				if (data.status === "success") {
					const flightResponse = await fetch(`${scriptURL}?email=${encodeURIComponent(emailInput.value.trim())}&sheet=Sheet2`);
					const flightData = await flightResponse.json();
					if (flightData && flightData.status === "success" && flightData.flights) {
						updateFlightSummary(flightData.flights);
					}
					// Változás 4: Ha a mentés sikeres, a flag-et false-ra állítjuk
					isDirty = false;
					// Ezzel a sorral frissítjük a mérőórát a mentés után
					fetchGaugeData(emailInput.value.trim()); 
					addflightForm.reset();
					calculateAltitudeDifference(addflightTakeoffSelect, addflightLandingSelect, addflightAltitudeDifferenceSpan);
				} else {
					throw new Error(data.message || "Flight saving failed");
				
				}
			} catch (error) {
				console.error("Error:", error);
				alert("Error: " + error.message);
			} finally {
				addflightSaveButton.disabled = false;
				saveFlightLoadingOverlay.style.display = "none";
			}
		});

    form.addEventListener("submit", async function (e) {
        e.preventDefault();
        submitButton.disabled = true;
        saveChecklistLoadingOverlay.style.display = "flex";
        const userEmail = emailInput.value.trim();
        if (!userEmail) {
            alert("Please enter your email to save.");
            submitButton.disabled = false;
            return;
        }
        const progress = {};
        const checkboxes = document.querySelectorAll('#checklist-container input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            progress[checkbox.name] = checkbox.checked ? "TRUE" : "FALSE";
        });
        const currentTitle = mainTitle.textContent;
        const clientNameMatch = currentTitle.match(/Pilot Checklist - (.+)/);
        const clientName = clientNameMatch ? clientName[1] : '';
        const data = {
            email: userEmail,
            clientName: clientName,
            progress: progress
        };
        try {
            const response = await fetch(`${scriptURL}?sheet=Sheet1`, {
                redirect: "follow",
                method: "POST",
                body: JSON.stringify(data),
                headers: {
                    "Content-Type": "text/plain;charset=utf-8",
                },
            });
            const result = await response.json();
            if (result.status === "success") {
                updateAllCompletions();
                // Változás 5: Ha a mentés sikeres, a flag-et false-ra állítjuk
                isDirty = false;
            } else {
                throw new Error(result.message || "Progress saving failed.");
            }
			 fetchGaugeData(userEmail); 
		} catch (error) {
            console.error("Error saving:", error);
            alert("Error saving: " + error.message);
        } finally {
            submitButton.disabled = false;
            saveChecklistLoadingOverlay.style.display = "none";
        }
    });

    addflightTakeoffSelect.addEventListener('change', () => calculateAltitudeDifference(addflightTakeoffSelect, addflightLandingSelect, addflightAltitudeDifferenceSpan));
    addflightLandingSelect.addEventListener('change', () => calculateAltitudeDifference(addflightTakeoffSelect, addflightLandingSelect, addflightAltitudeDifferenceSpan));
    
    document.addEventListener('DOMContentLoaded', () => {
        modalOverlay.style.display = 'flex';
        loginTabButton.addEventListener('click', () => showTab('login-section'));
        dashboardTabButton.addEventListener('click', () => showTab('dashboard-section'));
        flightDataTabButton.addEventListener('click', () => showTab('flight-data-section'));
        addflightTabButton.addEventListener('click', () => {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const formattedDate = `${yyyy}-${mm}-${dd}`;
            addflightDateInput.value = formattedDate;
            showTab('addflight-section');
        });
        checklistTabButton.addEventListener('click', () => showTab('checklist-container'));
		theoryTabButton.addEventListener('click', () => showTab('theory-section'));
		
		
        updateAllCompletions();
		
		
document.querySelectorAll('.check-item').forEach(item => {
    item.addEventListener("click", function (event) {
        // Exclude the input, slider, AND the new info-icon from toggling the checkbox.
        if (event.target.tagName.toLowerCase() !== 'input' && event.target.className.toLowerCase() !== 'slider' && !event.target.classList.contains('info-icon')) {
            const checkbox = this.querySelector('input[type="checkbox"]');
            if (checkbox) {
                checkbox.checked = !checkbox.checked;
                checkbox.dispatchEvent(new Event("change"));
            }
        }
    });
});

// Add a new event listener for the info icon
document.querySelectorAll('.info-icon').forEach(icon => {
    icon.addEventListener("click", function (event) {
        event.stopPropagation();
        const parentCheckItem = this.closest('.check-item');
        if (parentCheckItem) {
            const infoText = parentCheckItem.getAttribute('data-info-html'); // Változás itt: data-info-html
            if (infoText) {
                const modal = document.getElementById('infoModal');
                const modalBody = document.getElementById('modalBody');
                const modalTitle = document.getElementById('modalTitle');

                modalTitle.textContent = parentCheckItem.querySelector('span').textContent.replace(/[\d.]+\s*/, '').trim();
                modalBody.innerHTML = infoText; // Változás itt: innerHTML

                modal.style.display = "block";
            }
        }
    });
});

// Modal bezárása, ha a felhasználó a bezárás gombra kattint
document.querySelector('.close-button').addEventListener('click', function() {
    document.getElementById('infoModal').style.display = 'none';
});

// Modal bezárása, ha a felhasználó a modal ablakon kívülre kattint
window.addEventListener('click', function(event) {
    const modal = document.getElementById('infoModal');
    if (event.target === modal) {
        modal.style.display = 'none';
    }
});
		
		
        
        // Változás 6: Az állapotváltó beállítása a meglévő eseménykezelőben
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener("change", function () {
                isDirty = true; // EZ AZ ÚJ SOR
                const parentDiv = this.closest('.check-item');
                if (parentDiv) {
                    parentDiv.classList.toggle("completed", this.checked);
                    const card = parentDiv.closest('.w3-card');
                    if (card) {
                        updateCompletion(card);
                    }
                }
            });
        });

        // Változás 7: Az állapotváltó beállítása az "Add Flight" űrlapon
        addflightForm.addEventListener('input', function() {
            isDirty = true;
        });

        calculateAltitudeDifference(addflightTakeoffSelect, addflightLandingSelect, addflightAltitudeDifferenceSpan);
    });
</script>


<div id="infoModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2 id="modalTitle"></h2>
        <p id="modalBody"></p>
    </div>
</div>
</body>
</html>