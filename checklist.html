<!DOCTYPE html>
<html>
<head>
    <title>Pilot Checklist</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f1f1f1;
        }
        .container {
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .check-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            gap: 10px;
        }
        .check-item:last-child { border-bottom: none; }
        .check-item:hover { background-color: rgba(0,0,0,0.05); }
        .check-item.completed { background: #e6ffe6; color: green; font-weight: bold; }
        .switch {
            position: relative;
            display: inline-block;
            width: 42px;
            height: 22px;
            cursor: pointer;
            flex-shrink: 0;
        }
        .switch input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            margin: 0;
            padding: 0;
        }
        .slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .2s;
            border-radius: 22px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .2s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: #4CAF50; }
        input:checked + .slider:before { transform: translateX(20px); }
        .check-item span { user-select: none; }
        #message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            text-align: center;
        }
        .tab-button {
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2 class="w3-center" id="main-title">Pilot Checklist</h2>

        <div class="w3-bar w3-black">
            <button disabled class="w3-bar-item w3-button w3-blue tab-button" id="login-tab">LOGIN</button>
            
            <button class="w3-bar-item w3-button tab-button" id="checklist-tab" style="display: none;">Checklist</button>
			<button class="w3-bar-item w3-button tab-button" id="flight-data-tab" style="display: none;">Flight Data</button>
        </div>

        <div id="login-section" class="tab-content" style="margin-bottom: 20px;">
            <p>Please enter your email to load your progress:</p>
            <input class="w3-input w3-border w3-round" type="email" id="email-input" placeholder="Your email address">
            <button class="w3-button w3-green w3-round w3-margin-top" id="load-button">Load My Progress</button>
        </div>
        
        <div class="w3-container w3-padding tab-content" style="display:none;" id="flight-data-section">
            <div class="w3-card w3-round-large w3-margin">
                <div class="w3-container">
                    <h3>Flight Data Summary</h3>
                    
                    <div style="display: flex; justify-content: space-around; text-align: center; margin-top: 10px;">
                        <div>
                            <h4>Total Flights: <span id="total-flights-count-display">0</span></h4>
                            <div id="total-flights-progress" style="font-size: 24px;"></div>
                            <p id="total-flights-exam-status" style="font-weight: bold;"></p>
                        </div>
                        <div>
                            <h4>Takeoffs: <span id="takeoffs-count-display">0</span></h4>
                            <div id="takeoffs-progress" style="font-size: 24px;"></div>
                            <p id="takeoffs-exam-status" style="font-weight: bold;"></p>
                        </div>
                        <div>
                            <h4>Landings: <span id="landings-count-display">0</span></h4>
                            <div id="landings-progress" style="font-size: 24px;"></div>
                            <p id="landings-exam-status" style="font-weight: bold;"></p>
                        </div>
                    </div>
                    <p>Total air time: <span id="total-air-time-summary">0 minutes</span></p>
                    
                    <button class="w3-button w3-blue w3-round w3-margin-top w3-margin-bottom" id="add-flight-button">Add Flight</button>
                </div>
            </div>

            <div id="flight-form-section" style="display: none;">
                <div class="w3-card w3-round-large w3-margin">
                    <div class="w3-container">
                        <h3>New Flight</h3>
                        <form id="flight-form" method="post">
                            <p>
                                <label>Date:</label>
                                <input class="w3-input w3-border w3-round-large" type="date" name="flight-date" id="flight-date-input" required>
                            </p>
                            <p>
                                <label>Takeoff:</label>
                                <select class="w3-select w3-border w3-round-large" name="takeoff-location" id="takeoff-location" required>
                                    <option value="" disabled selected>Select a takeoff location</option>
                                    <option value="Büelen (1089m)">Büelen (1089m)</option>
                                    <option value="Brändlen-South (1208m)">Brändlen-South (1208m)</option>
									<option value="Brändlen-North (1228m)">Brändlen-North (1228m)</option>
									<option value="Diegisbalm (1103m)">Diegisbalm (1103m)</option>
									<option value="Engelberg Brunnihütte (1868m)">Engelberg Brunnihütte (1868m)</option>
									<option value="Engelberg (1803m)">Engelberg Tümpfeli (1803m)</option>
                                    <option value="Niderbauen (1572m)">Niderbauen (1572m)</option>
									<option value="Rigi - Staffelhöhe (1546m)">Rigi - Staffelhöhe (1546m)</option>
									<option value="Seebodenalp (1027m)">Seebodenalp (1027m)</option>
									<option value="Urmiberg (1111m)">Urmiberg (1111m)</option>
                                </select>
                            </p>
                            <p>
                                <label>Landing:</label>
                                <select class="w3-select w3-border w3-round-large" name="landing-location" id="landing-location" required>
                                    <option value="" disabled selected>Select a landing location</option>
                                    
                                    <option value="Brunnen (434m)">Brunnen (434m)</option>
									<option value="Diegisbalm (Nechimatt) (540m)">Diegisbalm (Nechimatt) (540m)</option>
									<option value="Emmetten (788m)">Emmetten (788m)</option>
									<option value="Engelberg (1008m)">Engelberg (1008m)</option>
									<option value="Küssnacht (461m)">Küssnacht (461m)</option>
									<option value="Neufallenbach (545m)">Neufallenbach (545m)</option>
                                    <option value="Wolfenschiessen (514m)">Wolfenschiessen (514m)</option>
                                </select>
                            </p>
                            <p>
                                <label>Altitude Difference:</label>
                                <span id="altitude-difference" class="w3-tag w3-round-large w3-light-grey">0m</span>
                            </p>
                            <p>
                                <label>Flight Time:</label>
                                <select class="w3-select w3-border w3-round-large" name="flight-time" required>
                                    <option value="" disabled selected>Select flight time</option>
                                    <option value="5">5 minutes</option>
                                    <option value="10">10 minutes</option>
                                    <option value="15">15 minutes</option>
                                    <option value="20">20 minutes</option>
                                    <option value="25">25 minutes</option>
                                    <option value="30+">30+ minutes</option>
                                </select>
                            </p>
                            <p>
                                <label>Comments:</label>
                                <textarea class="w3-input w3-border w3-round-large" name="comments" rows="3"></textarea>
                            </p>
                            <p>
                                <button id="save-flight-button" type="submit" class="w3-button w3-blue w3-round-large w3-margin-bottom">Save Flight</button>
                            </p>
                        </form>
                    </div>
                </div>
            </div>

            <div class="w3-card w3-round-large w3-margin">
                <div class="w3-container">
                    <h3>Flight book:</h3>
                    <ul id="flight-history-list" class="w3-ul w3-border-top">
                    </ul>
                </div>
            </div>
        </div>

        <div id="checklist-container" class="tab-content" style="display: none;">
            <form id="form">

                <div class="w3-row-padding w3-margin-top">
                    <div class="w3-half">
                        <div class="w3-card w3-white w3-margin-bottom">
                            <header class="w3-container">
                                <h4>Training Hill <span class="completion-display"></span></h4>
                            </header>
                            <div class="check-item">
                                <span>1. Laying out the glider</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-0" name="q-training-hill-0" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>2. Inflation and walking exercises</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-1" name="q-training-hill-1" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>3. Slalom walking</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-2" name="q-training-hill-2" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>4. Walking with braked wing</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-3" name="q-training-hill-3" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>5. Launch preparations and 5-Point Check</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-4" name="q-training-hill-4" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>6. Three Phase Launch</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-5" name="q-training-hill-5" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>7. Flights with direction changes</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-6" name="q-training-hill-6" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>8. Start-STOP (Decision making line)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-7" name="q-training-hill-7" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>9. Crosswind Launch (Simulation if necessary)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-8" name="q-training-hill-8" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>10. Launch with poorly laid-out canopy</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-9" name="q-training-hill-9" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>11. Launch with Forward &amp; Reverse inflation</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-10" name="q-training-hill-10" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>12. Landing technique and landings</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-11" name="q-training-hill-11" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>13. Emergency landing (Introduction)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-12" name="q-training-hill-12" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>14. Rescue system (Introduction)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-13" name="q-training-hill-13" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>15. 90 - 180° Turns (Landing Approach)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-14" name="q-training-hill-14" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>16. Untangling the lines</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-15" name="q-training-hill-15" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>17. Folding Methods</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-16" name="q-training-hill-16" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>18. Theory Test before the 1st High-Altitude Flight</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-training-hill-17" name="q-training-hill-17" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="w3-card w3-white w3-margin-bottom">
                            <header class="w3-container">
                                <h4>Theory <span class="completion-display"></span></h4>
                            </header>
                            <div class="check-item">
                                <span>1. Aerodynamics</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-theory-0" name="q-theory-0" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>2. Weather</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-theory-1" name="q-theory-1" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>3. Flying practice</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-theory-2" name="q-theory-2" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>4. Legislation (Air-law and airspaces)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-theory-3" name="q-theory-3" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>5. Material Sciences</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-theory-4" name="q-theory-4" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="w3-card w3-white w3-margin-bottom">
                            <header class="w3-container">
                                <h4>Extra <span class="completion-display"></span></h4>
                            </header>
                            <div class="check-item">
                                <span>1. 'Popo' landing</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-extra-0" name="q-extra-0" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>2. Big-Ears rolling</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-extra-1" name="q-extra-1" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>3. Paragliding etiquette (facultative)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-extra-2" name="q-extra-2" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>4. Decision making strategy (facultative)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-extra-3" name="q-extra-3" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="w3-half">
                        <div class="w3-card w3-white w3-margin-bottom">
                            <header class="w3-container">
                                <h4>High Flights <span class="completion-display"></span></h4>
                            </header>
                            <div class="check-item">
                                <span>1. Tandem Flight as a Passenger (optional)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-0" name="q-high-flights-0" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>2. Introduction to Emergency Landing</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-1" name="q-high-flights-1" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>3. Terrain Assessment and Launch Site Selection</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-2" name="q-high-flights-2" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>4. Launch with Forward &amp; Reverse Inflation</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-3" name="q-high-flights-3" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>5. Left and Right Circles</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-4" name="q-high-flights-4" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>6. Quick direction changes</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-5" name="q-high-flights-5" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>7. Figure Eight (PP2)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-6" name="q-high-flights-6" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>8. Tight Circles (with active control)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-7" name="q-high-flights-7" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>9. Parachutal stall (introduction)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-8" name="q-high-flights-8" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>10. Flying in the safe speed range</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-9" name="q-high-flights-9" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>11. Use of the acceleration system</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-10" name="q-high-flights-10" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>12. Positive and Negative steering</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-11" name="q-high-flights-11" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>13. Steering with weight shifting</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-12" name="q-high-flights-12" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>14. Steering with back risers</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-13" name="q-high-flights-13" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>15. Pitching (swinging around the lateral axis)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-14" name="q-high-flights-14" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>16. Rolling</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-15" name="q-high-flights-15" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>17. Assymetric Collapse (Level 1-4)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-16" name="q-high-flights-16" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>18. Big Ears (with speed bar)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-17" name="q-high-flights-17" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>19. Spiral (Introduction)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-18" name="q-high-flights-18" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>20. Flight with Instrument</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-19" name="q-high-flights-19" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>21. Dynamic Soaring (over 30 minutes)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-20" name="q-high-flights-20" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>22. Thermalling (over 30 minutes)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-21" name="q-high-flights-21" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>23. Landing approach (left/right)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-22" name="q-high-flights-22" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>24. Target landings</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-23" name="q-high-flights-23" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>25. Backwind landing (Introduction)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-24" name="q-high-flights-24" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>26. Landing with back risers</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-25" name="q-high-flights-25" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>27. Exam simulation</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-26" name="q-high-flights-26" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>28. Alone flight(s)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-high-flights-27" name="q-high-flights-27" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="w3-card w3-white w3-margin-bottom">
                            <header class="w3-container">
                                <h4>EXAM Maneuvers <span class="completion-display"></span></h4>
                            </header>
                            <div class="check-item">
                                <span>1. PP1 (2x right &lt;20s)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-exam-0" name="q-exam-0" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>2. PP2 (Left-Right &lt;25s)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-exam-1" name="q-exam-1" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>3. Side collapse (Lvl.3)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-exam-2" name="q-exam-2" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>4. Big Ears (90° left, 90° right)</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-exam-3" name="q-exam-3" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>5. Big Ears with speed</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-exam-4" name="q-exam-4" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>6. Rolling</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-exam-5" name="q-exam-5" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div class="check-item">
                                <span>7. Pitching</span>
                                <label class="switch">
                                    <input type="checkbox" id="q-exam-6" name="q-exam-6" value="TRUE" />
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="padding: 16px; text-align: center;">
                    <button class="w3-button w3-green w3-round" type="submit" id="submit-button">Save Progress</button>
                </div>
            </form>
        </div>
        <div id="message" style="display: none;"></div>
    </div>

<script>
    // A meglévő elemek
    const mainTitle = document.getElementById('main-title');
    const form = document.getElementById("form");
    const submitButton = document.getElementById("submit-button");
    const messageDiv = document.getElementById("message");
    const emailInput = document.getElementById("email-input");
    const loadButton = document.getElementById("load-button");
    const loginSection = document.getElementById("login-section");
    const checklistContainer = document.getElementById("checklist-container");

    const flightDataSection = document.getElementById("flight-data-section");
    const flightForm = document.getElementById("flight-form");
    const takeoffSelect = document.getElementById("takeoff-location");
    const landingSelect = document.getElementById("landing-location");
    const altitudeDifferenceSpan = document.getElementById("altitude-difference");
    const totalFlightsSummary = document.getElementById("total-flights-summary");
    const totalAirTimeSummary = document.getElementById("total-air-time-summary");
    const flightHistoryList = document.getElementById("flight-history-list");
    const saveFlightButton = document.getElementById("save-flight-button");
    const addFlightButton = document.getElementById("add-flight-button");
    const flightFormSection = document.getElementById("flight-form-section");
    const dateInput = document.getElementById("flight-date-input");

    const loginTabButton = document.getElementById("login-tab");
    const flightDataTabButton = document.getElementById("flight-data-tab");
    const checklistTabButton = document.getElementById("checklist-tab");

    // FIGYELEM: CSERÉLD KI EZT A SAJÁT GOOGLE APPS SCRIPT URL-EDDEL!
    const scriptURL = "https://script.google.com/macros/s/AKfycbwo2_GUywCuJhWrT4WlFJAEOZqL2klbgBRWCitO_RZ1Wz_-vAteDC4z9g3dbiBCWkLp/exec";

    // A meglévő helper funkciók
    function updateCompletion(cardElement) {
        const checkboxes = cardElement.querySelectorAll('input[type="checkbox"]');
        const checkedCheckboxes = Array.from(checkboxes).filter(checkbox => checkbox.checked);
        const totalCheckboxes = checkboxes.length;
        let completionPercentage = 0;
        if (totalCheckboxes > 0) {
            completionPercentage = (checkedCheckboxes.length / totalCheckboxes) * 100;
        }
        const completionDisplay = cardElement.querySelector('.completion-display');
        if (completionDisplay) {
            completionDisplay.textContent = `${completionPercentage.toFixed(0)}%`;
        }
    }
    function updateAllCompletions() {
        const allCards = document.querySelectorAll('.w3-card');
        allCards.forEach(card => updateCompletion(card));
    }
    function setChecklistValues(progress, clientName) {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            const value = progress[checkbox.name];
            const isChecked = (String(value).toLowerCase() === "true");
            checkbox.checked = isChecked;
            const parentDiv = checkbox.closest('.check-item');
            if (parentDiv) {
                parentDiv.classList.toggle('completed', isChecked);
            }
        });

        // Update the main title with the client's name
        mainTitle.textContent = clientName ? `Pilot Checklist - ${clientName}` : 'Pilot Checklist';

        updateAllCompletions();
    }

    function calculateAltitudeDifference() {
        const takeoffValue = takeoffSelect.value;
        const landingValue = landingSelect.value;
        let takeoffAltitude = 0;
        let landingAltitude = 0;

        if (takeoffValue) {
            const match = takeoffValue.match(/\((\d+)m\)/);
            if (match) {
                takeoffAltitude = parseInt(match[1]);
            }
        }
        if (landingValue) {
            const match = landingValue.match(/\((\d+)m\)/);
            if (match) {
                landingAltitude = parseInt(match[1]);
            }
        }
        
        const difference = takeoffAltitude - landingAltitude;
        altitudeDifferenceSpan.textContent = `${difference}m`;
    }

    function updateFlightSummary(flights) {
        flightHistoryList.innerHTML = '';
        let totalTime = 0;
        let takeoffLocations = new Set();
        let landingLocations = new Set();

        if (flights && flights.length > 0) {
            flights.forEach((flight, index) => {
                const [email, date, takeoff, landing, time, altitudeDifference, comments] = flight;
                
                let formattedDate = date;
                if (date) {
                    try {
                        const dateObj = new Date(date);
                        if (!isNaN(dateObj.getTime())) {
                            const day = String(dateObj.getDate()).padStart(2, '0');
                            const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                            const year = dateObj.getFullYear();
                            formattedDate = `${day}.${month}.${year}`;
                        } else {
                            // Fallback for non-standard date strings
                            const parts = date.split('-');
                            if (parts.length === 3) {
                                formattedDate = `${parts[2]}.${parts[1]}.${parts[0]}`;
                            } else {
                                // Last resort: regex for the user's observed format
                                const userFormatMatch = date.match(/(\d{2})T.*\.(\d{2})\.(\d{4})/);
                                if (userFormatMatch) {
                                    formattedDate = `${userFormatMatch[1]}.${userFormatMatch[2]}.${userFormatMatch[3]}`;
                                }
                            }
                        }
                    } catch (e) {
                        console.error("Date parsing error:", e);
                    }
                }

                const flightTime = parseInt(time) || 0;
                totalTime += flightTime;
                
                takeoffLocations.add(takeoff);
                landingLocations.add(landing);

                const listItem = document.createElement('li');
                listItem.className = 'w3-padding-small w3-border-bottom';
                listItem.innerHTML = `<strong>${index+1}.</strong> ${formattedDate}: <strong>${takeoff}</strong> -> <strong>${landing}</strong> (${time} minutes) - ${comments}`;
                flightHistoryList.appendChild(listItem);
            });
        }
        
        totalAirTimeSummary.textContent = `${totalTime} minutes`;
        
        // Update total flights visualization
        const totalFlightsCount = flights.length;
        const totalFlightsProgress = document.getElementById("total-flights-progress");
        const totalFlightsExamStatus = document.getElementById("total-flights-exam-status");
        document.getElementById("total-flights-count-display").textContent = totalFlightsCount;

        if (totalFlightsCount >= 50) {
            totalFlightsProgress.textContent = "✅";
            totalFlightsExamStatus.textContent = "Enough for the exam!";
            totalFlightsExamStatus.style.color = "green";
        } else {
            totalFlightsProgress.textContent = "❌";
            totalFlightsExamStatus.textContent = `Need ${50 - totalFlightsCount} more flight(s)`;
            totalFlightsExamStatus.style.color = "red";
        }

        // Update takeoff visualization
        const takeoffsCount = takeoffLocations.size;
        const takeoffsProgress = document.getElementById("takeoffs-progress");
        const takeoffsExamStatus = document.getElementById("takeoffs-exam-status");
        document.getElementById("takeoffs-count-display").textContent = takeoffsCount;

        if (takeoffsCount >= 5) {
            takeoffsProgress.textContent = "✅";
            takeoffsExamStatus.textContent = "Enough for the exam!";
            takeoffsExamStatus.style.color = "green";
        } else {
            takeoffsProgress.textContent = "❌";
            takeoffsExamStatus.textContent = `Need ${5 - takeoffsCount} more takeoff(s)`;
            takeoffsExamStatus.style.color = "red";
        }

        // Update landing visualization
        const landingsCount = landingLocations.size;
        const landingsProgress = document.getElementById("landings-progress");
        const landingsExamStatus = document.getElementById("landings-exam-status");
        document.getElementById("landings-count-display").textContent = landingsCount;

        if (landingsCount >= 5) {
            landingsProgress.textContent = "✅";
            landingsExamStatus.textContent = "Enough for the exam!";
            landingsExamStatus.style.color = "green";
        } else {
            landingsProgress.textContent = "❌";
            landingsExamStatus.textContent = `Need ${5 - landingsCount} more landing(s)`;
            landingsExamStatus.style.color = "red";
        }
    }

    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
        });

        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('w3-blue');
        });

        document.getElementById(tabId).style.display = 'block';
        
        const buttonId = tabId === 'login-section' ? 'login-tab' :
                         tabId === 'checklist-container' ? 'checklist-tab' : 'flight-data-tab';
        document.getElementById(buttonId).classList.add('w3-blue');
    }

    // Event Listeners
    loadButton.addEventListener("click", async () => {
        const userEmail = emailInput.value.trim();
        if (!userEmail) {
            alert("Please enter a valid email address.");
            return;
        }

        messageDiv.textContent = "Loading progress...";
        messageDiv.style.display = "block";
        messageDiv.style.backgroundColor = "beige";
        messageDiv.style.color = "black";
        
        loginTabButton.style.display = 'none';
        flightDataTabButton.style.display = 'block';
        checklistTabButton.style.display = 'block';
        flightFormSection.style.display = 'none';

        try {
            const checklistResponse = await fetch(`${scriptURL}?email=${encodeURIComponent(userEmail)}&sheet=Sheet1`);
            const checklistData = await checklistResponse.json();
            
            const flightResponse = await fetch(`${scriptURL}?email=${encodeURIComponent(userEmail)}&sheet=Sheet2`);
            const flightData = await flightResponse.json();

            if (checklistData && checklistData.status === "success" && flightData && flightData.status === "success") {
                setChecklistValues(checklistData.progress, checklistData.clientName);
                if (flightData.flights) {
                    updateFlightSummary(flightData.flights);
                } else {
                    updateFlightSummary([]);
                }
                
                showTab('checklist-container');
                messageDiv.textContent = "Progress loaded successfully!";
                messageDiv.style.backgroundColor = "#48c78e";
                messageDiv.style.color = "white";

            } else {
                throw new Error("Data loading failed. Please check your email address and sheets.");
            }

        } catch (error) {
            console.error("Error loading data:", error);
            alert("Error loading data. Starting a new form.");
            loginTabButton.style.display = 'block';
            flightDataTabButton.style.display = 'none';
            checklistTabButton.style.display = 'none';
            showTab('login-section');
        } finally {
            setTimeout(() => {
                messageDiv.style.display = "none";
            }, 4000);
        }
    });

    addFlightButton.addEventListener("click", () => {
        // Automatically set the date input to the current date
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
        const dd = String(today.getDate()).padStart(2, '0');
        const formattedDate = `${yyyy}-${mm}-${dd}`;
        dateInput.value = formattedDate;

        flightFormSection.style.display = 'block';
    });

    flightForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        saveFlightButton.disabled = true;
        
        const formData = new FormData(this);
        const flightDataObj = {
            email: emailInput.value.trim(),
            flightDate: formData.get("flight-date"),
            takeoffLocation: formData.get("takeoff-location"),
            landingLocation: formData.get("landing-location"),
            flightTime: formData.get("flight-time"),
            comments: formData.get("comments"),
            altitudeDifference: altitudeDifferenceSpan.textContent
        };

        try {
            const response = await fetch(`${scriptURL}?sheet=Sheet2`, {
                redirect: "follow",
                method: "POST",
                body: JSON.stringify(flightDataObj),
                headers: {
                    "Content-Type": "text/plain;charset=utf-8",
                },
            });
            const data = await response.json();
            if (data.status === "success") {
                alert("Flight saved successfully!");
                const flightResponse = await fetch(`${scriptURL}?email=${encodeURIComponent(emailInput.value.trim())}&sheet=Sheet2`);
                const flightData = await flightResponse.json();
                if (flightData && flightData.status === "success" && flightData.flights) {
                    updateFlightSummary(flightData.flights);
                }
                flightForm.reset();
                calculateAltitudeDifference();
                flightFormSection.style.display = 'none';
            } else {
                throw new Error(data.message || "Flight saving failed");
            }
        } catch (error) {
            console.error("Error:", error);
            alert("Error: " + error.message);
        } finally {
            saveFlightButton.disabled = false;
        }
    });

    form.addEventListener("submit", async function (e) {
        e.preventDefault();
        submitButton.disabled = true;

        const userEmail = emailInput.value.trim();
        if (!userEmail) {
            alert("Please enter your email to save.");
            submitButton.disabled = false;
            return;
        }

        const progress = {};
        const checkboxes = document.querySelectorAll('#checklist-container input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            progress[checkbox.name] = checkbox.checked ? "TRUE" : "FALSE";
        });
        
        const currentTitle = mainTitle.textContent;
        const clientNameMatch = currentTitle.match(/Pilot Checklist - (.+)/);
        const clientName = clientNameMatch ? clientNameMatch[1] : '';

        const data = {
            email: userEmail,
            clientName: clientName,
            progress: progress
        };

        try {
            const response = await fetch(`${scriptURL}?sheet=Sheet1`, {
                redirect: "follow",
                method: "POST",
                body: JSON.stringify(data),
                headers: {
                    "Content-Type": "text/plain;charset=utf-8",
                },
            });
            const result = await response.json();
            if (result.status === "success") {
                messageDiv.textContent = "Progress saved successfully!";
                messageDiv.style.display = "block";
                messageDiv.style.backgroundColor = "#48c78e";
                messageDiv.style.color = "white";
                setTimeout(() => {
                    messageDiv.style.display = "none";
                }, 4000);
            } else {
                throw new Error(result.message || "Progress saving failed.");
            }
        } catch (error) {
            console.error("Error saving:", error);
            alert("Error saving: " + error.message);
        } finally {
            submitButton.disabled = false;
        }
    });

    takeoffSelect.addEventListener('change', calculateAltitudeDifference);
    landingSelect.addEventListener('change', calculateAltitudeDifference);

    document.addEventListener('DOMContentLoaded', () => {
        loginTabButton.addEventListener('click', () => showTab('login-section'));
        flightDataTabButton.addEventListener('click', () => showTab('flight-data-section'));
        checklistTabButton.addEventListener('click', () => showTab('checklist-container'));

        updateAllCompletions(); 
        document.querySelectorAll('.check-item').forEach(item => {
            item.addEventListener("click", function (event) {
                if (event.target.tagName.toLowerCase() !== 'input' && event.target.className.toLowerCase() !== 'slider') {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    if (checkbox) {
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event("change"));
                    }
                }
            });
        });
        
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener("change", function () {
                const parentDiv = this.closest('.check-item');
                if (parentDiv) {
                    parentDiv.classList.toggle("completed", this.checked);
                    const card = parentDiv.closest('.w3-card');
                    if (card) {
                        updateCompletion(card);
                    }
                }
            });
        });

        calculateAltitudeDifference();
    });
</script>
</body>
</html>